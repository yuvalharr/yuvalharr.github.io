<!DOCTYPE html>
<html>
<head>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-resize.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-animation.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-call-function.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-survey-multi-choice.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-survey-likert.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-virtual-chin.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-new-virtual-chin.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-new-resize.js"></script>
    
    <script src="jspsych-6.1.0/plugins/jspsych-brms.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-brms-test.js"></script>

    <script src= "jspsych-6.1.0/jquery.min.js"></script>
    <script src= "jspsych-6.1.0/jquery-ui.min.js"></script>
    <script src= "jspsych-6.1.0/svg.min.js"></script>
    <link href="jspsych-6.1.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"></link> 
    <link href="jspsych-6.1.0/css/jquery-ui.css" rel="stylesheet" type="text/css"></link>
    <link href="jspsych-6.1.0/css/styles.css" rel="stylesheet" type="text/css"></link>
    <!--
    <script src="jspsych-6.1.0/lib/jquery-min.js" type="text/javascript"></script>

    -->  
    <script src="jspsych-6.1.0/lib/underscore-min.js" type="text/javascript"></script>
  
    <script src="jspsych-6.1.0/lib/backbone-min.js" type="text/javascript"></script>
  
    <script src="jspsych-6.1.0/lib/TweenMax.min.js"></script>
    <script src="jspsych-6.1.0/lib/CustomEase.js"></script>

    <script src="js/utils.js" type="text/javascript"></script>     

    <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>
<body></body>

<script>
document.body.style.backgroundColor = "ghostwhite";

var timeline = [];

// BRMS parameters for animation-test
var ITI = 1000,
    time_limit = 60 * (60 * 1000),
    stimAlphas = 0.4,
    unitSize = 4,
    breakEvery = 4,
    exp_num_faces = 4, // number of different faces to use per experiment  *yuval
    repetitions = 4, // number of repetitions of each face   *yuval
    total_num_faces = 300, // total number of faces in the database (e.g 300- for one gender only) (images file) *yuval
    train_repetitions = 5,
    train_alpha = 0.4,
    trialLength = 0, // 0 is no limit
    fade_in_time = 1,
    fade_out_time = 15,
    fade_out_length = 5,
    training_allowed_repeat = 1,
    experiment_performance_thresh = .85,
    experiment_performance_trials = 20,
    train_performance_thresh = .60,     ///////remember to return to 0.85
    experiment_RT_trials = 8,
    experiment_RT_trial_threshold = 5,
    experiment_RT_threshold = 300,
    sProblemCrit = 8,
    bProblemCrit = 2;

        var fullScreen = {
        type: 'fullscreen',
        fullscreen_mode: true,
        message: '<p>Please, press the button for full screen mode</p>',
        button_label: 'Full screen'    
        }
        
        var test_animation = {
          type: 'bRMS-test',
          timeline: [{
              stimulus: "f001.jpg",
              prompt: "<p>Testing for the \
            compatibility of your personal computer with this study.</p> \
            <p>This will take approximately 15 seconds more.</p>"
            },
            {
              stimulus: "f002.jpg",
              prompt: "<p>Testing for the \
            compatibility of your personal computer with this study.</p> \
            <p>This will take approximately 10 seconds more.</p>"
            },
            {
              stimulus: "m001.jpg",
              prompt: "<p>Testing for the \
            compatibility of your personal computer with this study.</p> \
            <p>This will take approximately 5 seconds more.</p>"
            }
          ],
          data: {
            timing_response: 4,
            stimulus_alpha: stimAlphas,
            timing_post_trial: 100,
            within_ITI: ITI - 100,
            fade_in_time: fade_in_time,
            fade_out_time: fade_out_time,
            fade_out_length: fade_out_length
      	  },
          stimulus_alpha: stimAlphas,
          timing_post_trial: 100,
          within_ITI: ITI - 100,
          timing_response: 4,
          fade_in_time: fade_in_time,
          fade_out_time: fade_out_time,
          fade_out_length: fade_out_length,
          visUnit: 4,
          choices: ["none"],
          colorOpts: ['#FF0000', '#00FF00', '#0000FF',
                             '#FFFF00', '#FF00FF', '#00FFFF']
        },
      poor_animation = {
      type: 'html-keyboard-response',
      conditional_function: function() {
        if (jsPsych.data.get().last(3).select('sProblem').sum() > sProblemCrit ||
          jsPsych.data.get().last(3).select('bProblem').sum() > bProblemCrit) {
          return true;
        } else {
            return false;
        }
      },
      timeline: [{
        stimulus: "<div class = 'center'>\
                  <p>It seems that the animation is not presented correctly on your computer.</p>\
                  <p>This may be due to old hardware, or too many open applications.</p>\
                  <p><b>Please return this study</b>.</p>\
                  <p>We'll be glad to see you participating in future studies.</p>\
                  <p>For any questions, please email \
                  yuval.harris@mail.huji.ac.il</p>\
                  <p>Press the space bar to continue.</p></div>"
      }],
      choices: [32],
      //** needed eventualy **//
      on_finish: function() {			 
  			 jsPsych.endExperiment('The experiment has been aborted');
  			}
    }
        
    var take_id = {
          type: 'survey-text',
          questions: [{
            prompt: "Please enter your MTurk Worker ID",
            name: "ID",
            columns: 18,
            rows: 1,
            value: ''
            }]
    }

    var trial_chin = {
        type: 'virtual-chin'
    }
               
timeline.push(test_animation, poor_animation, fullScreen, take_id, trial_chin);
        
jsPsych.init({
          timeline: timeline,
          on_finish: function() {
                            
                          //window.location.href = "https://y7uvs6a1rt.cognition.run/"
                          var cardWidth = jsPsych.data.get().values()[5].cardWidth_px
                          var viewing_distance = jsPsych.data.get().values()[5].viewing_distance_cm
                          var id = jsPsych.data.get().values()[4].responses
                          id = id.substring(7, id.length-2)
                          console.log(id.substring(7, id.length-2))
                          console.log(cardWidth)
                          console.log("distance=" + viewing_distance)
                          var msg = "exp finished"
                          console.log(msg)
                          window.location.href = "https://zscseoayyn.cognition.run//?id="+id+"&distance="+viewing_distance+"&width="+cardWidth;
                    }                       
})

</script>
</html>