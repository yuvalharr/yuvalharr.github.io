<!DOCTYPE html>
<html>
<head>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-yuval-animation.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-yuval-html-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-yuval-html.js"></script>
    <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>
<body style="background-color:ghostwhite;"></body> 
<script>


// YH- upload images 
function replicate(arr, times) { // function to help make array of many 'L's and 'R's 
     var al = arr.length,
         rl = al*times,
         res = new Array(rl);
     for (var i=0; i<rl; i++)
         res[i] = arr[i % al];
     return res;
}

var num_img_pairs = 80,
    absent_images = [],
    present_images = [],
    L_R_array = ['L', 'R'], // L & R array to replicate many times in the next row 
    random_var = replicate(L_R_array, num_img_pairs/2); // make half of the array 'L's and half 'R's
random_var = jsPsych.randomization.shuffle(random_var); // random_var is now shuffled to assign each trial with L or R couple of images
for (i = 1; i <= num_img_pairs; i++) { //YH- creating two arrays -> one for all 'absent' and one for all 'present' images  -YH
  absent_images.push('img/0' + i + '_' + random_var[i-1] + '_filler_absent' + '.jpg');
  present_images.push('img/0' + i + '_' + random_var[i-1] + '_filler_present' + '.jpg');
}

// YH- stimuli array preperation
var coupled = [];                  // make 'coupled' array -> each item is an array of coupled (a & b) images
for(var i=0; i < absent_images.length; i++){
   coupled.push([absent_images[i], present_images[i]]);
}
coupled = jsPsych.randomization.shuffle(coupled); // shuffle 'coupled' array

for (var i = 0; i < coupled.length; i++) { // create many arrays called animation_sequence_X
    this["animation_sequence_"+(i+1)] = coupled[i]; // in each array two items that are images a & b
} 

// YH- prepare stimuli for the timeline in an array. each item is {stimuli: animation_sequence_X}
var timeline_stimuli = []
var grid_images = ['img/image_part_001.jpg','img/image_part_002.jpg','img/image_part_003.jpg','img/image_part_004.jpg','img/image_part_005.jpg','img/image_part_006.jpg','img/image_part_007.jpg','img/image_part_008.jpg','img/image_part_009.jpg']
for(var i=1; i <= coupled.length; i++){
    var str ="animation_sequence_"+ i;
    var current_anim_seq = eval(str)
    var current_num = eval(str)[1].substring(4,6) // extracts num digits of current images. 
    var horizontal_images_array = ['img/01' + '_' + 1 + '.jpg', 'img/01' + '_' + 2+ '.jpg', 'img/01' + '_' + 3+ '.jpg', 'img/01' + '_' + 4+ '.jpg'] // after all images are in the folder '01' should be switched back to current_num - YH
    timeline_stimuli.push({stimuli: current_anim_seq, detection_image: current_anim_seq[1], horiz_imgs: horizontal_images_array, grid_images: grid_images }
                         );
}

// trial procedure to be repeated for each couple of images
var trial_procedure = {
    timeline: [
        {
            type: 'html-keyboard-response',
            stimulus: '<p style="font-size: 48px;">ready?</p>',
            choices: jsPsych.NO_KEYS,
            trial_duration: 1500,
            prompt: '<p style="font-size: 36px;">3</p>'
        },
        {
            type: 'html-keyboard-response',
            stimulus: '<p style="font-size: 48px;">ready?</p>',
            choices: jsPsych.NO_KEYS,
            trial_duration: 1500,
            prompt: '<p style="font-size: 36px;">2</p>'
        },
        {
            type: 'html-keyboard-response',
            stimulus: '<p style="font-size: 48px;">ready?</p>',
            choices: jsPsych.NO_KEYS,
            trial_duration: 1500,
            prompt: '<p style="font-size: 36px;">1</p>'
        },
        {
            type: 'animation',
            stimuli: jsPsych.timelineVariable('stimuli'),
            choices: [32],
            sequence_reps: 5,
            frame_isi: 200,
            frame_time: 1000
        },
        {
            type: 'yuval-html-button-response',
            stimulus: [],
            choices: jsPsych.timelineVariable('grid_images'),
            button_html: '<div class="wrapper"><div><img src=%choice%></div></div>',
            prompt: '<p style="font-size: 30px;">Where is the item located?</p>'
        },
        {
            type: 'yuval-html',
            stimulus: []
            
        },
        /*{
            type: 'html-button-response',
            stimulus: [],
            choices: jsPsych.timelineVariable('horiz_imgs'),
            button_html: '<div class="grid"><div><img src=%choice%></div></div>',
            prompt: "<p>Is this activity healthy or unhealthy?</p>"
        }, */
        {
            type: 'image-button-response',
            stimulus: jsPsych.timelineVariable('detection_image'),
            choices: ['A', 'B', 'C', 'D'],
            prompt: "<p>What collumn is it?</p>",
            margin_horizontal: '16px',
            button_html: '<button class="jspsych-btn-yuval">%choice%</button>'
        },
        {
            type: 'image-button-response',
            stimulus: jsPsych.timelineVariable('detection_image'),
            choices: ['1', '2','3','4'],
            prompt: "<p>What row is it?</p>",
            margin_vertical: '80px',
            margin_horizontal: '0px'
        },
    ],
    timeline_variables: timeline_stimuli
}

/* var animation_trial = {
    type: 'animation',
    sequence_reps: 5,
    frame_isi: 250,
    timeline: [
        {stimuli: animation_sequence_1},
        {stimuli: animation_sequence_2}
    ]
}; */

jsPsych.init({
    timeline: [trial_procedure],
    on_finish: function() {
      jsPsych.data.displayData();
    }
  });

</script>

</html>